{%load static%}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LISTES DES CENTRES DE FORMATION</title>
  <!-- Favicon icon -->


  <!-- jsPDF et AutoTable -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

  <!-- FileSaver pour Word -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

  <!-- docx via jsDelivr -->
  <script src="https://cdn.jsdelivr.net/npm/docx@7.7.0/build/index.umd.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/docx@9.5.0/dist/index.iife.js"></script>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css">
  <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
  <link rel="icon" type="image/png" sizes="16x16" href="{% static 'images/acfpe.png' %}" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />

  <link href="{% static 'vendor/datatables/css/jquery.dataTables.min.css'%}" rel="stylesheet" />
  <link href="{% static 'vendor/jquery-steps/css/jquery.steps.css'%}" rel="stylesheet" />
  <link href="{% static 'vendor/fullcalendar/css/fullcalendar.min.css'%}" rel="stylesheet" />
  <link href="{% static 'css/style.css'%}" rel="stylesheet" />
  <style>
    .wizard>.content>.body {
      max-height: 500px;
      overflow-y: auto;
      overflow-x: hidden;
      padding: 20px;
    }
  </style>

</head>

<body>
  <!--*******************
        Preloader start
    ********************-->
  <div id="preloader">
    <div class="sk-three-bounce">
      <div class="sk-child sk-bounce1"></div>
      <div class="sk-child sk-bounce2"></div>
      <div class="sk-child sk-bounce3"></div>
    </div>
  </div>
  <!--*******************
        Preloader end
    ********************-->

  <!--**********************************
        Main wrapper start
    ***********************************-->
  <div id="main-wrapper">
    <!--**********************************
            Nav header start
        ***********************************-->
    <div class="nav-header">
      <a href="{% url 'index' %}" class="brand-logo">
        <img class="img-fluid w-40 rounded center" src="{% static 'images/acfpe.png' %}" alt="" />
      </a>
      <div class="nav-control">
        <div class="hamburger">
          <span class="line"></span><span class="line"></span><span class="line"></span>
        </div>
      </div>
    </div>
    <!--**********************************
            Nav header end
        ***********************************-->

    <!--**********************************
            Header start
        ***********************************-->
    <div class="header">
      <div class="header-content">
        <nav class="navbar navbar-expand">
          <div class="collapse navbar-collapse justify-content-between">
            <div class="header-left">
              <div class="search_bar dropdown">
                <span class="search_icon p-3 c-pointer" data-toggle="dropdown">
                  <i class="mdi mdi-magnify"></i>
                </span>
                <div class="dropdown-menu p-0 m-0">
                  <form>
                    <input class="form-control" type="search" placeholder="Search" aria-label="Search" />
                  </form>
                </div>
              </div>
            </div>

            <ul class="navbar-nav header-right">
              <li class="nav-item dropdown notification_dropdown">
                <a class="nav-link" href="#" role="button" data-toggle="dropdown">
                  <i class="mdi mdi-bell"></i>
                  <div class="pulse-css"></div>
                </a>
                <div class="dropdown-menu dropdown-menu-right">
                  <ul class="list-unstyled">
                    <li class="media dropdown-item">
                      <span class="success"><i class="ti-user"></i></span>
                      <div class="media-body">
                        <a href="#">
                          <p>
                            <strong>Martin</strong> has added a
                            <strong>customer</strong> Successfully
                          </p>
                        </a>
                      </div>
                      <span class="notify-time">3:20 am</span>
                    </li>
                    <li class="media dropdown-item">
                      <span class="primary"><i class="ti-shopping-cart"></i></span>
                      <div class="media-body">
                        <a href="#">
                          <p>
                            <strong>Jennifer</strong> purchased Light
                            Dashboard 2.0.
                          </p>
                        </a>
                      </div>
                      <span class="notify-time">3:20 am</span>
                    </li>
                    <li class="media dropdown-item">
                      <span class="danger"><i class="ti-bookmark"></i></span>
                      <div class="media-body">
                        <a href="#">
                          <p>
                            <strong>Robin</strong> marked a
                            <strong>ticket</strong> as unsolved.
                          </p>
                        </a>
                      </div>
                      <span class="notify-time">3:20 am</span>
                    </li>
                    <li class="media dropdown-item">
                      <span class="primary"><i class="ti-heart"></i></span>
                      <div class="media-body">
                        <a href="#">
                          <p>
                            <strong>David</strong> purchased Light Dashboard
                            1.0.
                          </p>
                        </a>
                      </div>
                      <span class="notify-time">3:20 am</span>
                    </li>
                    <li class="media dropdown-item">
                      <span class="success"><i class="ti-image"></i></span>
                      <div class="media-body">
                        <a href="#">
                          <p>
                            <strong> James.</strong> has added a<strong>customer</strong>
                            Successfully
                          </p>
                        </a>
                      </div>
                      <span class="notify-time">3:20 am</span>
                    </li>
                  </ul>
                  <a class="all-notification" href="#">See all notifications <i class="ti-arrow-right"></i></a>
                </div>
              </li>
              <li class="nav-item dropdown header-profile">
                <a class="nav-link" href="#" role="button" data-toggle="dropdown">
                  <i class="mdi mdi-account"></i>
                </a>
                <div class="dropdown-menu dropdown-menu-right">
                  <a href="./app-profile.html" class="dropdown-item">
                    <i class="icon-user"></i>
                    <span class="ml-2">Profile </span>
                  </a>
                  <a href="./email-inbox.html" class="dropdown-item">
                    <i class="icon-envelope-open"></i>
                    <span class="ml-2">Inbox </span>
                  </a>
                  <a href="./page-login.html" class="dropdown-item">
                    <i class="icon-key"></i>
                    <span class="ml-2">Logout </span>
                  </a>
                </div>
              </li>
            </ul>
          </div>
        </nav>
      </div>
    </div>
    <!--**********************************
            Header end ti-comment-alt
        ***********************************-->

    <!--**********************************
            Sidebar start
        ***********************************-->
    <div class="quixnav">
      <div class="quixnav-scroll">
        <ul class="metismenu" id="menu">
          <li class="nav-label first">
            <hr>
          </li>
          <li>
            <a href="{% url 'index' %}" aria-expanded="false"><i class="bi bi-house"></i><span
                class="nav-text">Acceuil</span></a>
          </li>

          <li>
            <a class="has-arrow" href="javascript:void()" aria-expanded="false"><i class="mdi mdi-map-marker"></i><span
                class="nav-text">Localisation</span></a>
            <ul aria-expanded="false">
              <li><a href="{% url 'region' %}">Region</a></li>
              <li><a href="{% url 'prefecture' %}">Prefecture</a></li>
              <li>
                <a href="{% url 'sous_prefecture' %}">Sous Prefecture</a>
              </li>
              <li>
                <a href="{% url 'commune' %}">Commune / Arondissement</a>
              </li>
            </ul>
          </li>
          <li>
            <a class="has-arrow" href="javascript:void()" aria-expanded="false"><i class="fa fa-wrench"></i><span
                class="nav-text">Activit√©</span></a>
            <ul aria-expanded="false">
              <li><a href="{% url 'secteur' %}">Secteur</a></li>
              <li><a href="{% url 'publiccible' %}">Publics Cible</a></li>
            </ul>
          </li>

          <li>
            <a href="{% url 'centre_formation' %}" aria-expanded="false"><i class="fa fa-graduation-cap"></i>
              <span class="nav-text">Centre Formation</span></a>
          </li>
        </ul>
      </div>
    </div>
    <!--**********************************
            Sidebar end
        ***********************************-->

    <!--**********************************
            Content body start
        ***********************************-->
    <div class="content-body">
      <div class="container-fluid">
        <div class="row page-titles mx-0">
          <div class="col-sm-6 p-md-0">
            <div class="welcome-text">
              <h4>Centre Formation</h4>
              <p class="mb-0">Liste de tous les centres de formations</p>
            </div>
          </div>
          <div class="col-sm-6 p-md-0 justify-content-sm-end mt-2 mt-sm-0 d-flex">
            <ol class="list-inline d-flex gap-2">
              <!-- Bouton Exporter en PDF -->
              <li class="list-inline-item">
                <button id="export-pdf" class="btn btn-danger">Exporter en PDF</button>
              </li>

              <!-- Bouton Exporter en Word -->
              <li class="list-inline-item">
                <!-- Exporter en PDF (JS) -->


                <!-- Exporter en Word (JS) -->
                <button id="export-word" class="btn btn-info">Exporter en Word</button>

              </li>

              <!-- Bouton Ajouter -->
              <li class="list-inline-item">
                <a href="javascript:void()" data-toggle="modal" data-target="#add-category"
                  class="btn btn-primary btn-event">
                  <span class="align-middle"><i class="ti-plus"></i></span>
                  Ajouter
                </a>
              </li>
            </ol>
          </div>
        </div>
        <!-- row -->

        <div class="row">
          <div class="col-lg-3">
            <div class="card">
              <div class="card-body">
                <h4 class="card-intro-title">Filtrer par :</h4>
          
                <div class="d-flex flex-column gap-3">
          
                  <!-- R√©gion -->
                  <div class="form-group">
                    <label for="filtre-region">R√©gion :</label>
                    <select multiple size="" id="filtre-region" name="regions" class="form-control w-100">
                      {% for r in regions %}
                      <option value="{{ r.id }}">{{ r.nom }}</option>
                      {% endfor %}
                    </select>
                  </div>
          
                  <!-- Pr√©fecture -->
                  <div class="form-group">
                    <label for="filtre-prefecture">Pr√©fecture :</label>
                    <select multiple  id="filtre-prefecture" name="prefectures" class="form-control w-100">
                      {% for p in prefectures %}
                      <option value="{{ p.id }}">{{ p.nom }}</option>
                      {% endfor %}
                    </select>
                  </div>
          
                  <!-- Sous-pr√©fecture -->
                  <div class="form-group">
                    <label for="filtre-sousprefecture">Sous-pr√©fecture :</label>
                    <select multiple id="filtre-sousprefecture" name="sousprefectures" class="form-control w-100">
                      {% for sp in sousprefectures %}
                      <option value="{{ sp.id }}">{{ sp.nom }}</option>
                      {% endfor %}
                    </select>
                  </div>
          
                  <!-- Commune -->
                  <div class="form-group">
                    <label for="filtre-commune">Commune :</label>
                    <select multiple id="filtre-commune" name="communes" class="form-control w-100">
                      {% for c in communes %}
                      <option value="{{ c.id }}">{{ c.nom }}</option>
                      {% endfor %}
                    </select>
                  </div>
          
                  <!-- Secteur -->
                  <div class="form-group">
                    <label for="filtre-secteur">Secteur :</label>
                    <select size="1" multiple id="filtre-secteur" name="secteurs" class="form-control w-100">
                      {% for s in secteurs %}
                      <option value="{{ s.id }}">{{ s.nom }}</option>
                      {% endfor %}
                    </select>
                  </div>
          
                  <!-- Capacit√© -->
                  <div class="form-group">
                    <label for="filtre-capacite">Capacit√© max :</label>
                    <input type="number" id="filtre-capacite" name="capacite" class="form-control"
                      placeholder="Ex: 100" />
                  </div>
          
                </div>
              </div>
            </div>
          </div>
          
          
          <div class="col-lg-9">

            <div class="card">
              <div class="card-header">
                <h4 class="card-title">
                  Liste des Centres de Formation
                </h4>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table id="example" class="display" style="min-width: 845px">
                    <thead>
                      <tr>
                        <th>Intitule</th>
                        <th>Sigle</th>
                        <th>Adresse</th>
                        <th>Capacit√©</th>
                        <th>telephone</th>
                        <th>Commune</th>
                      </tr>
                    </thead>

                    <tbody id="tableau-centres">
                      {% for centre in centres %}
                      <tr class="centre-row"
                      data-region="{{ centre.commune.sousprefecture.prefecture.region.id }}"
                      data-prefecture="{{ centre.commune.sousprefecture.prefecture.id }}"
                      data-sousprefecture="{{ centre.commune.sousprefecture.id }}"
                      data-commune="{{ centre.commune.id }}"
                      data-secteurs="{% for s in centre.secteurs.all %}{{ s.id }} {% endfor %}"
                      data-capacite="{{ centre.capacite_max }}"
                        >

                        <td>
                          <a href="{% url 'centre_detail' centre.pk %}">
                            {{centre.intitule}}</a>
                        </td>
                        <td>{{centre.sigle}}</td>
                        <td>{{centre.adresse}}</td>
                        <td>{{centre.capacite_max}}</td>
                        <td>{{centre.telephone}}</td>
                        <td>{{centre.commune}}</td>
                      </tr>
                      {% endfor %}
                    </tbody>
                    <tfoot>
                      <tr>
                        <th>Intitule</th>
                        <th>Sigle</th>
                        <th>Adresse</th>
                        <th>Capacit√©</th>
                        <th>telephone</th>
                        <th>Commune</th>
                      </tr>
                    </tfoot>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <!-- BEGIN MODAL -->
          <div class="modal fade none-border" id="event-modal">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h4 class="modal-title"><strong>Add New Event</strong></h4>
                </div>
                <div class="modal-body"></div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-default waves-effect" data-dismiss="modal">
                    Close
                  </button>
                  <button type="button" class="btn btn-success save-event waves-effect waves-light">
                    Create event
                  </button>

                  <button type="button" class="btn btn-danger delete-event waves-effect waves-light"
                    data-dismiss="modal">
                    Delete
                  </button>
                </div>
              </div>
            </div>
          </div>
          <!-- Modal Add Category -->
          <div class="modal fade none-border" id="add-category">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h4 class="modal-title">
                    <strong>Ajout Centre Formation</strong>
                  </h4>
                </div>
                <div class="modal-body">
                  <form enctype="multipart/form-data" method="post" id="step-form-horizontal"
                    class="step-form-horizontal" action="{% url 'centre_formation' %}">
                    {% csrf_token %}
                    <div>
                      <h4>Centre de Formation</h4>
                      <section>
                        <div class="row">
                          <div class="col-lg-6 mb-4">
                            <div class="form-group">
                              <label class="text-label" for="{{ form_centre.secteurs.id_for_label }}">
                                Secteurs
                              </label>
                              {{ form_centre.secteurs }} {% if form_centre.secteurs.errors %}
                              <div class="text-danger mt-1">
                                {% for error in form_centre.secteurs.errors %}
                                <small>{{ error }}</small><br />
                                {% endfor %}
                              </div>
                              {% endif %}
                            </div>
                          </div>

                          <div class="col-lg-6 mb-4">
                            <div class="form-group">
                              <label class="text-label" for="{{ form_centre.public_cibles.id_for_label }}">
                                Publics cibles
                              </label>
                              {{ form_centre.public_cibles }} {% if form_centre.public_cibles.errors %}
                              <div class="text-danger mt-1">
                                {% for error in form_centre.public_cibles.errors %}
                                <small>{{ error }}</small><br />
                                {% endfor %}
                              </div>
                              {% endif %}
                            </div>
                          </div>

                          <div class="col-lg-12 mb-4">
                            <div class="form-group">
                              <label class="text-label" for="{{ form_centre.commune.id_for_label }}">
                                Commune
                              </label>
                              {{ form_centre.commune }} {% if form_centre.commune.errors %}
                              <div class="text-danger mt-1">
                                {% for error in form_centre.commune.errors %}
                                <small>{{ error }}</small><br />
                                {% endfor %}
                              </div>
                              {% endif %}
                            </div>
                          </div>

                          <div class="col-lg-12 mb-4">
                            <div class="form-group">
                              <label class="text-label" for="{{ form_centre.intitule.id_for_label }}">
                                Intitul√©
                              </label>
                              {{ form_centre.intitule }} {% if form_centre.intitule.errors %}
                              <div class="text-danger mt-1">
                                {% for error in form_centre.intitule.errors %}
                                <small>{{ error }}</small><br />
                                {% endfor %}
                              </div>
                              {% endif %}
                            </div>
                          </div>

                          <div class="col-lg-12 mb-4">
                            <div class="form-group">
                              <label class="text-label" for="{{ form_centre.sigle.id_for_label }}">
                                Sigle
                              </label>
                              {{ form_centre.sigle }} {% if form_centre.sigle.errors %}
                              <div class="text-danger mt-1">
                                {% for error in form_centre.sigle.errors %}
                                <small>{{ error }}</small><br />
                                {% endfor %}
                              </div>
                              {% endif %}
                            </div>
                          </div>

                          <div class="col-lg-12 mb-4">
                            <div class="form-group">
                              <label class="text-label" for="{{ form_centre.capacite_max.id_for_label }}">
                                Capacit√© max d'accueil/jours
                              </label>
                              {{ form_centre.capacite_max }} {% if form_centre.capacite_max.errors %}
                              <div class="text-danger mt-1">
                                {% for error in form_centre.capacite_max.errors %}
                                <small>{{ error }}</small><br />
                                {% endfor %}
                              </div>
                              {% endif %}
                            </div>
                          </div>

                          <div class="col-lg-12 mb-4">
                            <div class="form-group">
                              <label class="text-label" for="{{ form_centre.telephone.id_for_label }}">
                                T√©l√©phone
                              </label>
                              {{ form_centre.telephone }} {% if form_centre.telephone.errors %}
                              <div class="text-danger mt-1">
                                {% for error in form_centre.telephone.errors%}
                                <small>{{ error }}</small><br />
                                {% endfor %}
                              </div>
                              {% endif %}
                            </div>
                          </div>

                          <div class="col-lg-12 mb-4">
                            <div class="form-group">
                              <label class="text-label" for="{{ form_centre.email.id_for_label }}">
                                Email
                              </label>
                              {{ form_centre.email }} {% if form_centre.email.errors %}
                              <div class="text-danger mt-1">
                                {% for error in form_centre.email.errors %}
                                <small>{{ error }}</small><br />
                                {% endfor %}
                              </div>
                              {% endif %}
                            </div>
                          </div>

                          <div class="col-lg-12 mb-4">
                            <div class="form-group">
                              <label class="text-label" for="{{ form_centre.adresse.id_for_label }}">
                                Adresse
                              </label>
                              {{ form_centre.adresse }} {% if form_centre.adresse.errors %}
                              <div class="text-danger mt-1">
                                {% for error in form_centre.adresse.errors %}
                                <small>{{ error }}</small><br />
                                {% endfor %}
                              </div>
                              {% endif %}
                            </div>
                          </div>
                        </div>
                        <div class="col-lg-12 mb-4">
                          <div class="form-group">
                            <label class="text-label" for="{{ form_centre.liste_activites.id_for_label }}">
                              Liste des activit√©s propos√©es
                            </label>
                            {{ form_centre.liste_activites }} {% if form_centre.liste_activites.errors %}
                            <div class="text-danger mt-1">
                              {% for error in form_centre.liste_activites.errors %}
                              <small>{{ error }}</small><br />
                              {% endfor %}
                            </div>
                            {% endif %}
                          </div>
                        </div>
                        <div class="col-lg-12 mb-4">
                          <div class="form-group">
                            <label class="text-label" for="{{ form_centre.activites_populaires.id_for_label }}">
                              Activit√©s les plus populaires
                            </label>
                            {{ form_centre.activites_populaires }} {% if form_centre.activites_populaires.errors %}
                            <div class="text-danger mt-1">
                              {% for error in form_centre.activites_populaires.errors %}
                              <small>{{ error }}</small><br />
                              {% endfor %}
                            </div>
                            {% endif %}
                          </div>
                        </div>
                      </section>

                      <h4>Document administratif</h4>
                      <section>
                        <div class="row">
                          {% for field in form_docs %}
                          <div class="col-lg-12 mb-4">
                            <div class="form-group">
                              <label for="{{ field.id_for_label }}" class="text-label">
                                {{ field.label }}
                              </label>
                              {{ field }} {% if field.errors %}
                              <div class="text-danger mt-1">
                                {% for error in field.errors %}
                                <small>{{ error }}</small><br />
                                {% endfor %}
                              </div>
                              {% endif %}
                            </div>
                          </div>
                          {% endfor %}
                        </div>
                      </section>

                      <h4>Personne de Reference</h4>
                      <section>
                        <div class="row">
                          {% for field in form_ref %}
                          <div class="col-lg-12 mb-4">
                            <div class="form-group">
                              <label for="{{ field.id_for_label }}" class="text-label">
                                {{ field.label }}
                              </label>
                              {{ field }} {% if field.errors %}
                              <div class="text-danger mt-1">
                                {% for error in field.errors %}
                                <small>{{ error }}</small><br />
                                {% endfor %}
                              </div>
                              {% endif %}
                            </div>
                          </div>
                          {% endfor %}
                        </div>
                      </section>
                    </div>
                  </form>
                </div>
                <div class="modal-footer">
                  <!--<button type="button" class="btn btn-default waves-effect" data-dismiss="modal">Close</button>-->
                  <button type="button" class="btn btn-danger waves-effect waves-light save-category"
                    data-bs-dismiss="modal">
                    Close
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Script pour ouvrir la modale si erreurs -->
        </div>
      </div>
    </div>
    <!--**********************************
            Content body end
        ***********************************-->

    <!--**********************************
            Footer start
        ***********************************-->
    <div class="footer">
        <div class="copyright">
          <p>
            Copyright ¬© Designed &amp; Developed by
            <a href="#" target="_blank">Gilchrist KETTEGUIA</a> 2025
          </p>
        </div>
      </div>
    <!--**********************************
            Footer end
        ***********************************-->
  </div>
  <!--**********************************
        Main wrapper end
    ***********************************-->

  <!--**********************************
        Scripts
    ***********************************-->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const filters = [
        '#filtre-region',
        '#filtre-prefecture',
        '#filtre-sousprefecture',
        '#filtre-commune',
        '#filtre-secteur'
      ];

      filters.forEach(selector => {
        new Choices(selector, {
          removeItemButton: true,
          searchEnabled: true,
          placeholder: true,
          shouldSort: false
        });
      });
    });
  </script>

  <script>
    function getSelectedValues(selector) {
      return Array.from(document.querySelector(selector).selectedOptions).map(o => o.value);
    }

    function filterCentres() {
      const selectedRegions = getSelectedValues('#filtre-region');
      const selectedPrefectures = getSelectedValues('#filtre-prefecture');
      const selectedSousprefectures = getSelectedValues('#filtre-sousprefecture');
      const selectedCommunes = getSelectedValues('#filtre-commune');
      const selectedSecteurs = getSelectedValues('#filtre-secteur');
      const capaciteMax = parseInt(document.querySelector('#filtre-capacite').value) || Infinity;

      document.querySelectorAll('.centre-row').forEach(row => {
        const r = row.dataset.region;
        const p = row.dataset.prefecture;
        const sp = row.dataset.sousprefecture;
        const c = row.dataset.commune;
        const secteurs = row.dataset.secteurs.trim().split(/\s+/); // Liste d'ids
        const cap = parseInt(row.dataset.capacite);

        const matchRegion = selectedRegions.length === 0 || selectedRegions.includes(r);
        const matchPrefecture = selectedPrefectures.length === 0 || selectedPrefectures.includes(p);
        const matchSouspref = selectedSousprefectures.length === 0 || selectedSousprefectures.includes(sp);
        const matchCommune = selectedCommunes.length === 0 || selectedCommunes.includes(c);
        const matchSecteur = selectedSecteurs.length === 0 || selectedSecteurs.some(s => secteurs.includes(s));
        const matchCapacite = isNaN(cap) || cap <= capaciteMax;

        if (matchRegion && matchPrefecture && matchSouspref && matchCommune && matchSecteur && matchCapacite) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });
    }

    // √âcouteurs d'√©v√©nements sur tous les filtres
    ['#filtre-region', '#filtre-prefecture', '#filtre-sousprefecture', '#filtre-commune', '#filtre-secteur', '#filtre-capacite']
      .forEach(id => {
        document.querySelector(id).addEventListener('change', filterCentres);
      });
  </script>



  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // √âtapes du formulaire
      const sections = document.querySelectorAll("section");

      sections.forEach((section) => {
        // Appliquer form-control aux inputs (hors type checkbox/radio), selects et textareas
        section
          .querySelectorAll("input, select, textarea")
          .forEach((input) => {
            const type = input.getAttribute("type");

            if (
              type !== "checkbox" &&
              type !== "radio" &&
              !input.classList.contains("form-control")
            ) {
              input.classList.add("form-control");
            }
          });

        // Styliser les checkbox
        section
          .querySelectorAll('input[type="checkbox"]')
          .forEach((checkbox) => {
            checkbox.classList.add("form-check-input");

            const label = checkbox.closest("label");
            if (label) {
              label.classList.add("form-check-label");
              // Optionnel : ajouter un conteneur div.form-check autour si absent
              if (!label.closest(".form-check")) {
                const wrapper = document.createElement("div");
                wrapper.classList.add("form-check");
                label.parentNode.insertBefore(wrapper, label);
                wrapper.appendChild(label);
              }
            }
          });
      });
    });
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      let hasErrors = false;

      {% if form_centre.errors or form_docs.errors or form_ref.errors %}
      hasErrors = true;
      {% endif %}

      if (hasErrors) {
        var myModal = new bootstrap.Modal(document.getElementById('add-category'));
        myModal.show();
      }
    });
  </script>

  <script>
    $(document).ready(function () {
      var form = $("#step-form-horizontal");

      form.validate({
        errorClass: "text-danger",
        errorElement: "small",
        ignore: ":hidden", // important pour ignorer les champs masqu√©s dans les autres √©tapes
        rules: {
          intitule: "required",
          telephone: "required",
          email: {
            required: true,
            email: true,
          },
        },
        messages: {
          intitule: "Ce champ est obligatoire",
          telephone: "Un num√©ro de t√©l√©phone est requis",
          email: {
            required: "Un email est requis",
            email: "Veuillez entrer un email valide",
          },
        },
      });

      form.steps({
        headerTag: "h4",
        bodyTag: "section",
        transitionEffect: "fade",
        autoFocus: true,
        onStepChanging: function (event, currentIndex, newIndex) {
          // Important : ignorer les champs cach√©s
          form.validate().settings.ignore = ":hidden";
          return form.valid();
        },
        onFinishing: function (event, currentIndex) {
          form.validate().settings.ignore = ":hidden";
          return form.valid();
        },
        onFinished: function (event, currentIndex) {
          form.submit();
        },
      });
    });
  </script>

  <script>
    // üìÑ Exporter en PDF avec jsPDF
    document.getElementById("export-pdf").addEventListener("click", function () {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      // R√©cup√®re uniquement les lignes visibles
      const visibleRows = Array.from(document.querySelectorAll("#example tbody tr"))
        .filter(row => row.offsetParent !== null);

      // Cr√©er une table HTML temporaire uniquement avec les lignes visibles
      const tempTable = document.createElement("table");
      tempTable.innerHTML = document.querySelector("#example thead").outerHTML;

      const tbody = document.createElement("tbody");
      visibleRows.forEach(row => tbody.appendChild(row.cloneNode(true)));
      tempTable.appendChild(tbody);

      doc.autoTable({
        html: tempTable,
        startY: 20,
        theme: "grid",
        headStyles: { fillColor: [220, 53, 69] },
      });

      doc.save("centres_filtr√©s.pdf");
    });

    // üìÑ Exporter en Word avec docx
    document.getElementById("export-word").addEventListener("click", function () {
      const {
        Document, Packer, Paragraph, Table, TableCell, TableRow, TextRun
      } = window.docx;

      const table = document.getElementById("example");
      const headerCells = Array.from(table.querySelectorAll("thead th")).map(th =>
        new TableCell({
          children: [new Paragraph({ children: [new TextRun(th.innerText)] })],
        })
      );

      const visibleRows = Array.from(table.querySelectorAll("tbody tr"))
        .filter(row => row.offsetParent !== null);

      const dataRows = visibleRows.map(row => {
        const cells = Array.from(row.querySelectorAll("td")).map(td =>
          new TableCell({
            children: [new Paragraph({ children: [new TextRun(td.innerText)] })],
          })
        );
        return new TableRow({ children: cells });
      });

      const doc = new Document({
        sections: [
          {
            properties: {},
            children: [
              new Paragraph({ text: "Liste des centres filtr√©s", heading: "Heading1" }),
              new Table({
                rows: [
                  new TableRow({ children: headerCells }),
                  ...dataRows
                ]
              })
            ]
          }
        ]
      });

      Packer.toBlob(doc).then(blob => {
        saveAs(blob, "centres_filtr√©s.docx");
      });
    });
  </script>



  <!-- Required vendors -->
  <script src="{% static 'vendor/global/global.min.js'%}"></script>
  <script src="{% static 'js/quixnav-init.js'%}"></script>
  <script src="{% static 'js/custom.min.js'%}"></script>
  <!--removeIf(production)-->
  <!-- Demo scripts -->
  <script src="{% static 'js/styleSwitcher.js'%}"></script>

  <script src="{% static 'vendor/jqueryui/js/jquery-ui.min.js'%}"></script>
  <script src="{% static 'vendor/moment/moment.min.js'%}"></script>

  <script src="{% static 'vendor/fullcalendar/js/fullcalendar.min.js'%}"></script>
  <script src="{% static 'js/plugins-init/fullcalendar-init.js'%}"></script>

  <script src="{% static 'vendor/jquery-steps/build/jquery.steps.min.js'%}"></script>
  <script src="{% static 'vendor/jquery-validation/jquery.validate.min.js'%}"></script>
  <!-- Form validate init -->
  <script src="{% static 'js/plugins-init/jquery.validate-init.js'%}"></script>

  <!-- Form step init -->
  <script src="{% static 'js/plugins-init/jquery-steps-init.js'%}"></script>

  <script src="{% static 'vendor/datatables/js/jquery.dataTables.min.js'%}"></script>
  <script src="{% static 'js/plugins-init/datatables.init.js'%}"></script>
</body>

</html>